module.exports=function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e){t.exports=flarum.core.compat["forum/app"]},,function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/components/Badge"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,e){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["common/components/Page"]},function(t,e){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e){t.exports=flarum.core.compat["forum/components/EventPost"]},function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(4),s=n(5),u=n.n(s),i=n(2),c=n.n(i),l=n(6),f=n.n(l),d=n(7),p=n.n(d),h=n(8),v=n.n(h),g=n(3),k=n.n(g);function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,y(t,e)}var x=n(9),w=n.n(x),F=n(10),S=n.n(F),D=n(11),j=n.n(D);function T(t){return!!t.dataTransfer&&(t.dataTransfer.types.includes("text/uri-list")||t.dataTransfer.types.includes("text/x-moz-url"))}function O(t){t.dataTransfer&&T(t)&&(t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="move",t.redraw=!1,this.classList.add("valid-drop"))}var P=function(t){function e(){return t.apply(this,arguments)||this}b(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),r.a.store.find("discussions",{filter:{featureScheduled:1},page:{limit:50}}).then((function(){m.redraw()}))},n.view=function(){var t=[];return(r.a.forum.attribute("featureDiscussionsSchedule")||[]).forEach((function(e){t.push({custom:!1,date:dayjs(e),discussions:[]})})),r.a.store.all("discussions").forEach((function(e){if(e.attribute("featuredFrom")){var n=dayjs(e.attribute("featuredFrom"));t.some((function(a,r){return a.date.isSame(n)?(a.discussions.push(e),!0):!!(r>0&&a.date.isAfter(n))&&(t.splice(r-1,0,{custom:!0,date:n,discussions:[e]}),!0)}))}})),m(".container",m(".sideNavContainer",[m("nav.IndexPage-nav.sideNav",m("ul",S()(k.a.prototype.sidebarItems().toArray()))),m(".sideNavOffset",[m("p",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.schedule.help")),m(".FeaturedScheduleList",t.map((function(t){return m(".FeaturedScheduleSlot",[m(".FeaturedScheduleDate",[t.custom?[m("span.FeaturedScheduleCustom","["+r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.schedule.custom")+"]")," "]:null,t.date.format("YYYY-MM-DD HH:mm:ss")+" ",m("em","("+t.date.fromNow()+")")]),m(".FeaturedScheduleDrop",{ondragover:O,ondragenter:O,ondragleave:function(){this.classList.remove("valid-drop")},ondrop:function(e){var n=this;if(e.dataTransfer&&T(e)){var a=function(t){if(!t.dataTransfer)return null;var e=t.dataTransfer.getData("URL");e||(e=t.dataTransfer.getData("text/plain"));var n=new RegExp(r.a.route("discussion",{id:"==id=="}).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("==id==","([^/]+)")+"(/[0-9]+)?$").exec(e);return n?n[1]:null}(e);e.preventDefault(),e.stopPropagation(),this.classList.remove("valid-drop");var o=function(){n.classList.add("invalid-drop"),setTimeout((function(){n.classList.remove("invalid-drop")}),2e3)};if(a){var s=r.a.store.getBy("discussions","slug",a),u={featuredFrom:t.date.toISOString()};s?s.save(u).then((function(){m.redraw()})):r.a.store.find("discussions",a,{bySlug:!0,include:"user,lastPostedUser"}).then((function(t){t.save(u).then((function(){m.redraw()}))})).catch((function(t){throw o(),t}))}else o()}}},[m(".FeaturedScheduleDropHere",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.schedule.drop-here")),m(".FeaturedScheduleDropError",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.schedule.drop-error")),0===t.discussions.length?m(".FeaturedScheduleDropEmpty",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.schedule.empty")):null,t.discussions.map((function(t){return m(".FeaturedScheduleDiscussion",{draggable:!0,ondragstart:function(e){if(e.dataTransfer){var n=this.getBoundingClientRect(),a=r.a.forum.attribute("baseUrl")+r.a.route.discussion(t);e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/uri-list",a),e.dataTransfer.setData("text/plain",a),e.dataTransfer.setDragImage(this,e.pageX-n.left-window.scrollX,e.pageY-n.top-window.scrollY)}}},j.a.component({discussion:t,params:{}}))}))])])})))])]))},e}(w.a),M=n(12),Y=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))||this).attrs=void 0,e.from=null,e.until=null,e}b(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.from=this.attrs.discussion.attribute("featuredFrom")||null,this.until=this.attrs.discussion.attribute("featuredUntilEdit")||null},n.className=function(){return"FeatureModal"},n.title=function(){return r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.title")},n.content=function(){var t=this;return m(".Modal-body",[m(".Form-group",[m("label",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.fields.from")),m("label",[m("input",{type:"radio",name:"featuredFrom",value:"off",checked:null===this.from,onchange:function(){t.from=null,t.until=null}})," ",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.from.not")]),m("label",[m("input",{type:"radio",name:"featuredFrom",value:"next",checked:"next"===this.from,onchange:function(){t.from="next"}})," ",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.from.next")]),m("label",[m("input",{type:"radio",name:"featuredFrom",value:"manual",checked:null!==this.from&&"next"!==this.from,onchange:function(){t.from="",setTimeout((function(){t.$("input.js-featured-from").focus()}),0)}})," ",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.from.manual"),m("input.FormControl.js-featured-from",{type:"text",value:"next"!==this.from?this.from:"",onchange:function(e){t.from=e.target.value},disabled:null===this.from||"next"===this.from})])]),m(".Form-group",[m("label",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.fields.until")),m("label",[m("input",{type:"radio",name:"featuredUntil",value:"auto",checked:null===this.until,onchange:function(){t.until=null}})," ",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.until.auto")]),m("label",[m("input",{type:"radio",name:"featuredUntil",value:"manual",checked:null!==this.until,onchange:function(){t.until="",setTimeout((function(){t.$("input.js-featured-until").focus()}),0)}})," ",r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.until.manual"),m("input.FormControl.js-featured-until",{type:"text",value:this.until,onchange:function(e){t.until=e.target.value},disabled:null===this.until})])]),m(".Form-group",[c.a.component({className:"Button",onclick:function(){r.a.modal.close()}},r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.action.cancel"))," ",c.a.component({type:"submit",className:"Button Button--primary"},r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.modal.action.submit"))])])},n.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.attrs.discussion.save({featuredFrom:this.from,featuredUntil:this.until}).then((function(){e.loading=!1,r.a.modal.close()}),this.loaded)},e}(n.n(M).a),_=n(13);function L(t){if(!t)return r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.post.auto");var e=dayjs(t);return e.format("YYYY-MM-DD HH:mm:ss")+" ("+e.fromNow()+")"}var B=function(t){function e(){return t.apply(this,arguments)||this}b(e,t);var n=e.prototype;return n.icon=function(){return"fas fa-certificate"},n.descriptionKey=function(){return"clarkwinkelmann-featured-discussions.forum.post."+(this.attrs.post.content().length,"scheduled")},n.descriptionData=function(){var t=this.attrs.post.content();return{from:L(t.length>0?t[0]:null),until:L(t.length>1?t[1]:null)}},e}(n.n(_).a);r.a.initializers.add("clarkwinkelmann-featured-discussions",(function(){r.a.routes.featureSchedule={path:"/feature-schedule",component:P},r.a.postComponents.featureScheduled=B,Object(o.extend)(v.a,"moderationControls",(function(t,e){e.attribute("canFeature")&&t.add("feature",c.a.component({icon:"fas fa-certificate",onclick:function(){r.a.modal.show(Y,{discussion:e})}},r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.controls.feature")))})),Object(o.extend)(p.a.prototype,"badges",(function(t){this.attribute("isFeatured")&&t.add("featured",u.a.component({label:r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.badge"),icon:"fas fa-certificate",type:"featured"}))})),Object(o.extend)(k.a.prototype,"navItems",(function(t){r.a.forum.attribute("showSchedulePage")&&t.add("feature-schedule",f.a.component({href:r.a.route("featureSchedule"),icon:"fas fa-certificate"},r.a.translator.trans("clarkwinkelmann-featured-discussions.forum.nav.schedule")))}))}))}]);
//# sourceMappingURL=forum.js.map